{% extends "form.html" %}

{%- from 'govuk_frontend_jinja/components/input/macro.html' import govukInput -%}
{%- from 'components/moj-pagination.html' import mojPagination -%}
{%- from 'govuk_frontend_jinja/components/table/macro.html' import govukTable -%}
{%- from "govuk_frontend_jinja/components/warning-text/macro.html" import govukWarningText %}
{%- from 'macros/flash_messages.html' import renderFlashMessages %}


{% block content %}

  <div class="govuk-grid-row">
    <div class="govuk-grid-column-full">
      {% if form and form.errors %}
            {{ govukErrorSummary(wtforms_errors(form)) }}
        {% endif %}

      {{ renderFlashMessages() }}

    <span class="govuk-caption-xl">{{ form.caption }}</span>
    {% if not form.firm.is_advocate and not form.firm.is_barrister %}
        <h1 class="govuk-heading-l govuk-!-margin-bottom-1">Office: {{ form.office.firm_office_code }}</h1>
        <p class="govuk-body">{{ office_address }}</p>
    {% endif %}

      <h1 class="govuk-heading-xl govuk-!-margin-top-7 govuk-!-margin-bottom-2">{{ form.title }}</h1>

      <form method="get" class="govuk-!-margin-bottom-6">
          <div class="govuk-form-group--search">
            {{ form.search() }}
            {{ govukButton({'text': 'Search', 'classes': 'govuk-button--secondary'}) }}
          </div>
      </form>

      {% if form.search_term not in [none, ""] %}
        <h2 class="govuk-heading-m">{{ form.num_results }} search {{ "result" if form.num_results == 1 else "results" }} for '{{ form.search_term }}'</h2>
      {% endif %}

      {% if form.search_term is not none  and form.num_results > 0 %}
        <form method="post">
          {{ form.hidden_tag() }}

          <div class="govuk-form-group {% if form.bank_account.errors %} govuk-form-group--error{% endif %}">

            {% if form.bank_account.errors %}
                {% for error in form.bank_account.errors %}
                    <p class="govuk-error-message">
                      <span class="govuk-visually-hidden">Error:</span> {{ error }}
                    </p>
                {% endfor %}
            {% endif %}

            {{ govukTable(form.bank_accounts_table.to_govuk_params(selected_value=form.selected_value)) }}

          </div>

          {{ mojPagination(currentPage=form.page, numShownPerPage=form.ITEMS_PER_PAGE, numResults=form.num_results, searchTerm=form.search_term) }}

          <br>

          {{ govukButton({'text': 'Submit'}) }}
          {{ govukButton({'text': 'Add a new bank account', "classes": "govuk-button--secondary govuk-!-margin-left-2", "href": add_new_bank_account_url}) }}
        </form>
      {% endif %}
    </div>
  </div>

{% endblock %}