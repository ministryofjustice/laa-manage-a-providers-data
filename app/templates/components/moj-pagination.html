{% macro mojPagination(currentPage=1,numShownPerPage=20, numResults=100, searchTerm="") %}
  {%- set startResult = ((currentPage - 1) * numShownPerPage) + 1 %}
  {%- set endResult = [currentPage * numShownPerPage, numResults] | min %}
  {%- set maxPage = (numResults / numShownPerPage)|round(method='ceil')|int %}
  {%- set showDots = maxPage > 7 %}
  {%- set pageRange = 1 %}

  {%- set queryString = '' %}

  {%- if searchTerm is not none%}
    {# If you need to preserve additional query string args add them here #}
    {%- set queryString = '&search=' + searchTerm | urlencode %}
  {%- endif %}

  <nav class="moj-pagination govuk-!-padding-left-1" aria-label="Pagination navigation">
    <ul class="moj-pagination__list govuk-pagination__list">
      {% if maxPage > 1 %}
        {% if currentPage > 1 %}
        <div class="govuk-pagination__prev">
          <a class="govuk-link govuk-pagination__link" href="{{ baseUrl }}?page={{ currentPage - 1 }}{{ queryString }}" rel="prev">
            <svg class="govuk-pagination__icon govuk-pagination__icon--prev" xmlns="http://www.w3.org/2000/svg" height="13" width="15" aria-hidden="true" focusable="false" viewBox="0 0 15 13">
              <path d="m6.5938-0.0078125-6.7266 6.7266 6.7441 6.4062 1.377-1.449-4.1856-3.9768h12.896v-2h-12.984l4.2931-4.293-1.414-1.414z"></path>
            </svg>
            <span class="govuk-pagination__link-title">
              Previous<span class="govuk-visually-hidden"> page</span>
            </span>
          </a>
        </div>
        {% endif %}

        {% if not showDots %}
          {% for page in range(1, maxPage + 1) %}
            {% if page == currentPage %}
            <li class="govuk-pagination__item govuk-pagination__item--current">
              <a class="govuk-link govuk-pagination__link" href="#" aria-label="Page {{ page }}" aria-current="page">
                {{ page }}
              </a>
            </li>
            {% else %}
            <li class="govuk-pagination__item">
              <a class="govuk-link govuk-pagination__link"
                 href="{{ baseUrl }}?page={{ page }}{{ queryString }}"
                 aria-label="Page {{ page }}">{{ page }}</a>
            </li>
            {% endif %}
          {% endfor %}
        {% else %}

          {% if currentPage == 1 %}
          <li class="govuk-pagination__item govuk-pagination__item--current">
            <a class="govuk-link govuk-pagination__link" href="#" aria-label="Page 1" aria-current="page">
              1
            </a>
          </li>
          {% else %}
          <li class="govuk-pagination__item">
            <a class="govuk-link govuk-pagination__link"
               href="{{ baseUrl }}?page=1{{ queryString }}"
               aria-label="Page 1">1</a>
          </li>
          {% endif %}

          {% if currentPage - pageRange > 2 %}
          <li class="govuk-pagination__item govuk-pagination__item--ellipses">
            &ctdot;
          </li>
          {% endif %}

          {% set startPage = [2, currentPage - pageRange ] | max %}
          {% set endPage = [maxPage - 1, currentPage + pageRange] | min %}

          {% for page in range(startPage, endPage + 1) %}
            {% if page != 1 and page != maxPage %}
              {% if page == currentPage %}
              <li class="govuk-pagination__item govuk-pagination__item--current">
                <a class="govuk-link govuk-pagination__link" href="#" aria-label="Page {{ page }}" aria-current="page">
                  {{ page }}
                </a>
              </li>
              {% else %}
              <li class="govuk-pagination__item">
                <a class="govuk-link govuk-pagination__link"
                   href="{{ baseUrl }}?page={{ page }}{{ queryString }}"
                   aria-label="Page {{ page }}">{{ page }}</a>
              </li>
              {% endif %}
            {% endif %}
          {% endfor %}

          {% if currentPage < maxPage - pageRange - 1 %}
          <li class="govuk-pagination__item govuk-pagination__item--ellipses">
            &ctdot;
          </li>
          {% endif %}

          {% if maxPage > 1 %}
            {% if currentPage == maxPage %}
            <li class="govuk-pagination__item govuk-pagination__item--current">
              <a class="govuk-link govuk-pagination__link" href="#" aria-label="Page {{ maxPage }}" aria-current="page">
                {{ maxPage }}
              </a>
            </li>
            {% else %}
            <li class="govuk-pagination__item">
              <a class="govuk-link govuk-pagination__link"
                 href="{{ baseUrl }}?page={{ maxPage }}{{ queryString }}"
                 aria-label="Page {{ maxPage }}">{{ maxPage }}</a>
            </li>
            {% endif %}
          {% endif %}
        {% endif %}

        {% if currentPage < maxPage %}
        <div class="govuk-pagination__next">
          <a class="govuk-link govuk-pagination__link" href="{{ baseUrl }}?page={{ currentPage + 1 }}{{ queryString }}" rel="next">
            <span class="govuk-pagination__link-title">
              Next<span class="govuk-visually-hidden"> page</span>
            </span>
            <svg class="govuk-pagination__icon govuk-pagination__icon--next" xmlns="http://www.w3.org/2000/svg" height="13" width="15" aria-hidden="true" focusable="false" viewBox="0 0 15 13">
              <path d="m8.107-0.0078125-1.4136 1.414 4.2926 4.293h-12.986v2h12.896l-4.1855 3.9766 1.377 1.4492 6.7441-6.4062-6.7246-6.7266z"></path>
            </svg>
          </a>
        </div>
        {% endif %}
      {% endif %}
    </ul>

    {% if numResults > 0 %}
    <p class="moj-pagination__results">
      Showing <b>{{ startResult }}</b> to <b>{{ endResult }}</b> of <b>{{ numResults }}</b> results
    </p>
    {% endif %}
  </nav>
{% endmacro %}